@page "/login"
@using Microsoft.AspNetCore.Identity
@using PetHouse.Models

<PageTitle>Log In</PageTitle>

<h2>Log In</h2>
<div>
    <EditForm Model="loginModel" OnValidSubmit="Login">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label for="usernameLabel" class="form-label">Enter Username:</label>
            <InputText id="usernameLabel" class="form-control" @bind-Value="loginModel.Username" placeholder="Username" />
        </div>

        <div class="mb-3">
            <label for="passwordLabel" class="form-label">Enter Password:</label>
            <InputText id="passwordLabel" class="form-control" type="password" @bind-Value="loginModel.Password" placeholder="Password" />
        </div>

        <button type="submit" class="btn btn-primary">Sign In</button>
    </EditForm>
</div>

@code {

    public User loginModel = new();

    private async Task Login()
    {

        var result = await SignInManager.PasswordSignInAsync(

            loginModel.Username,

            loginModel.Password,

            isPersistent: false,

            lockoutOnFailure: false);

        if (result.Succeeded)
        {
            // Redirect to another page (e.g., dashboard)
            NavigationManager.NavigateTo("/dashboard");
        }
        else
        {
            // Display error message to the user
            Console.WriteLine("Login failed. Please check your credentials.");
        }
    }

    [Inject]
    private SignInManager<IdentityUser> SignInManager { get; set; }

    [Inject]
    private NavigationManager NavigationManager { get; set; }
}